<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Hello MUI</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="css/mui.min.css">
		<link rel="stylesheet" type="text/css" href="css/icons-extra.css"/>
		<link rel="stylesheet" type="text/css" href="css/font-awesome.min.css"/>
		<link rel="stylesheet" type="text/css" href="css/style.css"/>
	</head>
	<body>
		<div id="filter">
			<div class="mui-row">
			    <div class="mui-col-sm-4 mui-col-xs-4 mui-filter-continer">
			    	<ul id="provice">
			    	</ul>
			    </div>
			    <div class="mui-col-sm-4 mui-col-xs-4 mui-filter-continer">
			    	<ul id="cities">
			    		
			    	</ul>
			    </div>
			    <div class="mui-col-sm-4 mui-col-xs-4 mui-filter-continer">
			    	<ul id="areas">
			    		
			    	</ul>
			    </div>
			</div>
		</div>
		<!--<div  style="width:100%; height:220px; position: absolute;top: 0;left: 0;z-index: 100;overflow: hidden;display:block;background-color:#E8E8E8;">
			<div class="mui-row">
			    <div class="mui-col-sm-12 mui-col-xs-12 mui-text-center">
			    	
			    </div>
			</div>
		</div>-->
		<!--下拉刷新容器-->
		<div id="pullrefresh" class="mui-content mui-scroll-wrapper">
			<div class="mui-scroll">
				<!--数据列表-->
				<ul class="mui-table-view mui-grid-view">
			        <!--<li class="mui-table-view-cell mui-media mui-col-xs-6">
			            <a href="details.html">
			               	<img class="mui-media-object" src="images/shuijiao.jpg">
			                <div class="mui-media-body">幸福就是可以一起睡觉</div>
			            </a>
			        </li> -->
			    </ul>   
			</div>
		</div> 
		<script src="js/mui.min.js"></script>
		<script src="js/jquery-3.2.1.min.js"></script>
		<script src="js/city.data-3.js"></script>
		<script>
			mui.init({
				pullRefresh: {
					container: '#pullrefresh',
					down: {
						callback: pulldownRefresh
					},
					up: {
						contentrefresh: '正在加载...',
						callback: pullupRefresh
					}
				}
			});
			/**
			 * 下拉刷新具体业务实现
			 */
			function pulldownRefresh() {
				setTimeout(function() {
					var table = document.body.querySelector('.mui-table-view');
					var cells = document.body.querySelectorAll('.mui-table-view-cell');
					for (var i = cells.length, len = i + 3; i < len; i++) {
						var li = document.createElement('li');
						li.className = 'mui-table-view-cell mui-col-xs-6';
						li.innerHTML = '<a href="#"><img class="mui-media-object" src="images/yuantiao.jpg"><div class="mui-media-body"></div></a>';
						//下拉刷新，新纪录插到最前面；
						//table.insertBefore(li, table.firstChild);
					}
					mui('#pullrefresh').pullRefresh().endPulldownToRefresh(); //refresh completed
				}, 200);
			}
			var count = 0;
			/**
			 * 上拉加载具体业务实现
			 */
			function pullupRefresh() {
				setTimeout(function() {
					mui('#pullrefresh').pullRefresh().endPullupToRefresh((++count > 2)); //参数为true代表没有更多数据了。
					var table = document.body.querySelector('.mui-table-view');
					var cells = document.body.querySelectorAll('.mui-table-view-cell');
					for (var i = cells.length, len = i + 20; i < len; i++) {
						var li = document.createElement('li');
						li.className = 'mui-table-view-cell mui-col-xs-6';
						li.innerHTML = '<a href="details.html" class="mui-category-list">'
							+'<img class="mui-media-object" src="images/yuantiao.jpg">'
							+'<div class="mui-media-body">'
							+'<h4 class="title">静静看这世界</h4>'
							+'<p class="price"><i class="fa fa-cny"></i>99.00</p>'
							+'<p class="location"><i class="fa fa-map-marker"></i>北京市昌平区北七家镇</p>'
							+'</div>'
							+'</a>';
						table.appendChild(li);
					}
				}, 200);
			}
			if (mui.os.plus) {
				mui.plusReady(function() {
					setTimeout(function() {
						mui('#pullrefresh').pullRefresh().pullupLoading();
					}, 1000);
				});
			} else {
				mui.ready(function() {
					mui('#pullrefresh').pullRefresh().pullupLoading();
				});
			}
			
			mui.ready(function() {
				mui(document).on('tap','a',function(e){
					e.preventDefault();
					var id = this.href;
					mui.openWindow({
						id:id,
						url:id
					});
				});
				$(document).on('click','.mui-filter-continer li',function(){
					$(this).addClass('active').siblings().removeClass('active');
				});
				//省
				var provice = document.body.querySelector('#provice');
				for (var i=0;i<cityData3.length;i++) {
					var li = document.createElement('li');
					li.setAttribute('data-id',cityData3[i].value);
					li.innerHTML=cityData3[i].text;
					provice.appendChild(li);
				}
				$(document).on('click','#provice li',function(){
					$('#cities,#areas').empty();
					var html = '';
					var value = $(this).attr('data-id');
					for (var i=0;i<cityData3.length;i++) {
						if(cityData3[i].value==value){
							for (var j = 0; j < cityData3[i].children.length; j++) {
								html += '<li data-id="'+cityData3[i].children[j].value+'">'+cityData3[i].children[j].text+'</li>';
							}
						}
					}
					$('#cities').html(html);
					$('#cities').parent().scrollTop(0);
				});
				$(document).on('click','#cities li',function(){
					$('#areas').empty();
					var html = '';
					var value = $(this).attr('data-id');
					for (var i=0;i<cityData3.length;i++) {
						for(var j=0;j<cityData3[i].children.length;j++){
							if(cityData3[i].children[j].value==value){
								for (var k = 0; k < cityData3[i].children[j].children.length; k++) {
									html += '<li data-id="'+cityData3[i].children[j].children[k].value+'" data-area="'+cityData3[i].text+" "+cityData3[i].children[j].text+" "+cityData3[i].children[j].children[k].text+'">'+cityData3[i].children[j].children[k].text+'</li>';
								}
							}
						}
					}
					$('#areas').html(html);
					$('#areas').parent().scrollTop(0);
				});
			});
			mui.plusReady(function(){
				$(document).on('click','#areas li',function(){
					var parent = plus.webview.getWebviewById('categray_list.html');
					var value = $(this).attr('data-area');
					var text = $(this).text();
					parent.evalJS('document.getElementById("cityResult3").innerHTML="'+text+'";');
					$('#filter').hide();
					$('li.active').removeClass('active');
					$('#cities,#areas').empty();
				});
			});
		</script>
	</body>
</html>